pages:
  image: rustdocker/rust:nightly
  script:
    - rustup target add wasm32-unknown-unknown
    - cargo install wasm-bindgen-cli
    - RUSTFLAGS=--cfg=web_sys_unstable_apis cargo build --target wasm32-unknown-unknown --release
    - wasm-bindgen target/wasm32-unknown-unknown/release/coap-ace-poc-webapp.wasm --out-dir public/ --web
    - 'sed "s/BUILDID/$(cat public/{index.html,coap-ace-poc*} | sha256sum | cut -f1 -d" ")/" < public/service_worker.js.in > public/service_worker.js'
  artifacts:
    paths:
      - public
